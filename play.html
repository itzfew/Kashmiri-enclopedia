<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Play</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .profile {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .container {
            max-width: 900px;
            margin: auto;
            padding: 30px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid #007BFF;
            transition: transform 0.3s;
        }
        .container:hover {
            transform: scale(1.02);
        }
        h1 {
            text-align: center;
            color: #007BFF;
            margin-bottom: 20px;
            font-weight: 700;
        }
        .question {
            margin: 20px 0;
            font-size: 1.4em;
            font-weight: 500;
            border-bottom: 2px solid #007BFF;
            padding-bottom: 10px;
        }
        .options {
            margin: 20px 0;
        }
        .option {
            padding: 15px;
            border: 2px solid #007BFF;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s, border-color 0.3s, transform 0.3s;
            margin-bottom: 15px;
            background: #e3f2fd;
            position: relative;
        }
        .option:hover {
            background: #bbdefb;
            transform: translateY(-2px);
        }
        .option.selected {
            background: #007BFF;
            color: white;
            border-color: #0056b3;
        }
        .btn {
            background: #007BFF;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s, transform 0.3s;
            margin-top: 15px;
            font-size: 1em;
            font-weight: 600;
        }
        .btn:hover {
            background: #0056b3;
            transform: scale(1.05);
        }
        .result {
            margin-top: 20px;
            font-weight: bold;
            text-align: center;
            font-size: 1.4em;
            color: #28a745;
        }
        .progress {
            margin-top: 20px;
            text-align: center;
            font-weight: 600;
        }
        .progress-bar {
            width: 100%;
            background: #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 10px;
            background: #007BFF;
            width: 0;
            transition: width 0.3s;
        }
        .timer {
            font-size: 1.2em;
            color: #dc3545;
            text-align: center;
            margin: 20px 0;
        }
        .detailed-results {
            margin-top: 20px;
            display: none;
        }
        .detailed-results h2 {
            text-align: center;
            color: #28a745;
        }
        .detailed-results table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .detailed-results th, .detailed-results td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        .detailed-results th {
            background-color: #f2f2f2;
            font-weight: 700;
        }
        .correct {
            background-color: #d4edda;
            color: #155724;
        }
        .incorrect {
            background-color: #f8d7da;
            color: #721c24;
        }
        .chart-container {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .chart {
            width: 80%;
            height: 400px;
        }
        .question-list {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #007BFF;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .question-list h2 {
            text-align: center;
            color: #007BFF;
        }
        .question-list ul {
            list-style-type: none;
            padding: 0;
        }
        .question-list li {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #007BFF;
            transition: background 0.3s;
        }
        .question-list li.correct {
            background-color: #d4edda;
            color: #155724;
        }
        .question-list li.incorrect {
            background-color: #f8d7da;
            color: #721c24;
        }
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            .btn {
                padding: 10px;
                font-size: 0.9em;
            }
            .question {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Play Quiz</h1>
        <div class="profile" id="profile" onclick="toggleLogin()">
            <img id="profilePic" src="" alt="Profile Picture" style="display: none;">
            <span id="profileName">Login / Signup</span>
        </div>
    </header>
    
    <div class="container">
        <div class="timer" id="timer">Time Left: <span id="timeLeft"></span></div>
        <div id="quizContainer" class="question"></div>
        <div class="options" id="optionsContainer"></div>
        <div class="progress">
            Question <span id="currentQuestionIndex">1</span> of <span id="totalQuestions"></span>
            <div class="progress-bar">
                <div id="progressBarFill" class="progress-bar-fill"></div>
            </div>
        </div>
        <button class="btn" id="nextButton" onclick="nextQuestion()">Next</button>
        <button class="btn" id="submitButton" onclick="submitQuiz()" style="display:none;">Submit</button>
        <div id="result" class="result"></div>
        <div id="detailedResults" class="detailed-results"></div>
        <div class="chart-container" id="chartContainer" style="display: none;">
            <canvas id="scoreChart" class="chart"></canvas>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCotpjWvQ5cG5cOpgiNvpAS4ftvwKRO_N0",
            authDomain: "eduhub-a3762.firebaseapp.com",
            databaseURL: "https://eduhub-a3762-default-rtdb.firebaseio.com",
            projectId: "eduhub-a3762",
            storageBucket: "eduhub-a3762.appspot.com",
            messagingSenderId: "115221366217",
            appId: "1:115221366217:web:d6cee26ef04752d1519418",
            measurementId: "G-X1MQF5SR3Z"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let timer;
        const totalQuestions = 10; // Number of questions

        const loadQuestions = () => {
            // Example questions. Replace this with your database retrieval logic
            questions = [
                { question: "What is 2 + 2?", options: ["3", "4", "5", "6"], answer: "4" },
                { question: "What is the capital of France?", options: ["London", "Berlin", "Paris", "Madrid"], answer: "Paris" },
                // Add more questions as needed
            ];
            document.getElementById('totalQuestions').innerText = questions.length;
            displayQuestion();
        };

        const displayQuestion = () => {
            const currentQuestion = questions[currentQuestionIndex];
            document.getElementById('quizContainer').innerText = currentQuestion.question;
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            currentQuestion.options.forEach(option => {
                const div = document.createElement('div');
                div.innerText = option;
                div.className = 'option';
                div.onclick = () => selectOption(option);
                optionsContainer.appendChild(div);
            });

            document.getElementById('currentQuestionIndex').innerText = currentQuestionIndex + 1;
            document.getElementById('totalQuestions').innerText = questions.length;
            updateProgressBar();
        };

        const selectOption = (selectedOption) => {
            const currentQuestion = questions[currentQuestionIndex];
            const options = document.querySelectorAll('.option');

            options.forEach(option => {
                option.classList.remove('selected');
                if (option.innerText === selectedOption) {
                    option.classList.add('selected');
                }
            });

            if (selectedOption === currentQuestion.answer) {
                score++;
            }
        };

        const nextQuestion = () => {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                submitQuiz();
            }
        };

        const submitQuiz = () => {
            clearInterval(timer);
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('optionsContainer').style.display = 'none';
            document.getElementById('nextButton').style.display = 'none';
            document.getElementById('submitButton').style.display = 'none';

            const resultContainer = document.getElementById('result');
            resultContainer.innerText = `Your score: ${score}/${questions.length}`;

            saveScoreToDatabase();
            showDetailedResults();
            displayChart();
        };

        const saveScoreToDatabase = () => {
            const user = firebase.auth().currentUser;
            if (user) {
                const scoreData = {
                    name: user.displayName,
                    email: user.email,
                    examId: "quiz1",
                    score,
                    timestamp: Date.now()
                };

                database.ref(`scores/${user.uid}/quiz1`).set(scoreData)
                    .then(() => console.log('Score saved successfully!'))
                    .catch(error => console.error('Error saving score:', error));
            }
        };

        const showDetailedResults = () => {
            const detailedResults = document.getElementById('detailedResults');
            detailedResults.innerHTML = '<h2>Detailed Results</h2><table><tr><th>Question</th><th>Your Answer</th><th>Correct Answer</th></tr>';

            questions.forEach((question, index) => {
                const answer = document.querySelector(`.option.selected`).innerText;
                const correct = question.answer;
                const className = answer === correct ? 'correct' : 'incorrect';
                detailedResults.innerHTML += `<tr class="${className}"><td>${question.question}</td><td>${answer}</td><td>${correct}</td></tr>`;
            });

            detailedResults.innerHTML += '</table>';
            detailedResults.style.display = 'block';
        };

        const displayChart = () => {
            const chartContainer = document.getElementById('chartContainer');
            const ctx = document.getElementById('scoreChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Your Score', 'Total Questions'],
                    datasets: [{
                        label: 'Score',
                        data: [score, questions.length],
                        backgroundColor: ['#007BFF', '#ddd']
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            chartContainer.style.display = 'block';
        };

        const updateProgressBar = () => {
            const progressBarFill = document.getElementById('progressBarFill');
            const percentage = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBarFill.style.width = percentage + '%';
        };

        const startTimer = () => {
            let timeLeft = 60; // 1 minute timer
            document.getElementById('timeLeft').innerText = timeLeft;

            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timeLeft').innerText = timeLeft;

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    submitQuiz();
                }
            }, 1000);
        };

        const initializeQuiz = () => {
            loadQuestions();
            startTimer();
        };

        const toggleLogin = () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithPopup(provider).catch(error => {
                console.error('Error signing in:', error);
            });
        };

        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                document.getElementById('profilePic').src = user.photoURL;
                document.getElementById('profilePic').style.display = 'block';
                document.getElementById('profileName').innerText = user.displayName;
                initializeQuiz();
            } else {
                document.getElementById('profilePic').style.display = 'none';
                document.getElementById('profileName').innerText = 'Login / Signup';
            }
        });

    </script>
</body>
</html>
