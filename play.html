<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Play</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header>
            <h1>Play Quiz</h1>
        </header>

        <main>
            <div class="timer" id="timer">Time Left: <span id="timeLeft"></span></div>
            <div id="quizContainer" class="question"></div>
            <div class="options" id="optionsContainer"></div>
            <button class="btn" id="nextButton" onclick="nextQuestion()">Next</button>
            <button class="btn" id="submitButton" onclick="submitQuiz()" style="display:none;">Submit</button>
            <div id="result" class="result"></div>
            <div id="detailedResults" class="detailed-results"></div>
        </main>

        <footer>
            <p>&copy; 2024 Quiz Web App</p>
        </footer>
    </div>

    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCotpjWvQ5cG5cOpgiNvpAS4ftvwKRO_N0",
  authDomain: "eduhub-a3762.firebaseapp.com",
  databaseURL: "https://eduhub-a3762-default-rtdb.firebaseio.com",
  projectId: "eduhub-a3762",
  storageBucket: "eduhub-a3762.appspot.com",
  messagingSenderId: "115221366217",
  appId: "1:115221366217:web:d6cee26ef04752d1519418",
  measurementId: "G-X1MQF5SR3Z"
};
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let results = [];
        let timer;
        const timePerQuestion = 60; // 1 minute per question

        function getExamId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('examId');
        }

        function loadQuestions() {
            const examId = getExamId();
            database.ref(`exams/${examId}/quizzes`).once('value').then(snapshot => {
                snapshot.forEach(childSnapshot => {
                    questions.push(childSnapshot.val());
                });
                displayQuestion();
            }).catch(error => {
                console.error('Error loading questions:', error);
            });
        }

        function displayQuestion() {
            const questionContainer = document.getElementById('quizContainer');
            const optionsContainer = document.getElementById('optionsContainer');
            const questionData = questions[currentQuestionIndex];

            questionContainer.innerHTML = `<h3>${questionData.question}</h3>`;
            optionsContainer.innerHTML = '';
            questionData.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.innerText = option;
                optionDiv.onclick = () => selectOption(index + 1);
                optionsContainer.appendChild(optionDiv);
            });

            startTimer();
        }

        function startTimer() {
            let timeLeft = timePerQuestion;
            document.getElementById('timeLeft').innerText = formatTime(timeLeft);
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timeLeft').innerText = formatTime(timeLeft);
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    alert('Time is up for this question!');
                    nextQuestion();
                }
            }, 1000);
        }

        function formatTime(seconds) {
            return `${Math.floor(seconds / 60)}:${seconds % 60 < 10 ? '0' : ''}${seconds % 60}`;
        }

        function selectOption(selectedOption) {
            const optionElements = document.querySelectorAll('.option');
            optionElements.forEach((optionElement, index) => {
                optionElement.classList.remove('selected');
                if (index + 1 === selectedOption) {
                    optionElement.classList.add('selected');
                }
            });
            results[currentQuestionIndex] = {
                question: questions[currentQuestionIndex].question,
                selected: selectedOption,
                correct: questions[currentQuestionIndex].correctOption
            };
        }

        function nextQuestion() {
            clearInterval(timer);
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                displayQuestion();
            } else {
                submitQuiz();
            }
        }

        function submitQuiz() {
            clearInterval(timer);
            calculateScore();
            showResults();
            saveScoreToDatabase();
        }

        function calculateScore() {
            score = results.reduce((total, result) => {
                if (result.selected == result.correct) return total + 4;
                if (result.selected) return total - 1;
                return total;
            }, 0);
        }

        function showResults() {
            const totalQuestions = questions.length;
            const correctAnswers = results.filter(result => result.selected == result.correct).length;
            const incorrectAnswers = results.filter(result => result.selected && result.selected != result.correct).length;
            const missedQuestions = totalQuestions - correctAnswers - incorrectAnswers;
            const percentage = ((correctAnswers * 4) / (totalQuestions * 4)) * 100;

            const resultText = `
                <h2>Your Results</h2>
                <p>Total Questions: ${totalQuestions}</p>
                <p>Correct Answers: ${correctAnswers}</p>
                <p>Incorrect Answers: ${incorrectAnswers}</p>
                <p>Missed Questions: ${missedQuestions}</p>
                <p>Total Score: ${score}</p>
                <p>Percentage: ${percentage.toFixed(2)}%</p>
            `;
            document.getElementById('result').innerHTML = resultText;

            showDetailedResults();
        }

        function showDetailedResults() {
            const detailedResultsContainer = document.getElementById('detailedResults');
            detailedResultsContainer.innerHTML = `<h3>Detailed Results</h3><table><tr><th>Question</th><th>Your Answer</th><th>Correct Answer</th></tr>`;
            results.forEach(result => {
                const yourAnswer = result.selected ? result.selected : 'Not Answered';
                const correctAnswer = result.correct;
                const rowClass = result.selected === result.correct ? 'correct' : 'incorrect';
                detailedResultsContainer.innerHTML += `
                    <tr class="${rowClass}">
                        <td>${result.question}</td>
                        <td>${yourAnswer}</td>
                        <td>${correctAnswer}</td>
                    </tr>`;
            });
            detailedResultsContainer.innerHTML += `</table>`;
            detailedResultsContainer.style.display = 'block';
        }

        function saveScoreToDatabase() {
            const userId = 'exampleUserId'; // Replace with actual user ID logic
            const examId = getExamId();
            const scoreData = {
                userId,
                examId,
                score,
                timestamp: Date.now()
            };

            database.ref(`scores/${userId}/${examId}`).set(scoreData).then(() => {
                console.log('Score saved successfully!');
            }).catch(error => {
                console.error('Error saving score:', error);
            });
        }

        window.onload = loadQuestions;
    </script>
</body>
</html>
