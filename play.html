<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play Quiz</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1 id="examTitle"></h1>
        <div id="quizContainer"></div>
        <button class="btn" id="submitQuiz">Submit Quiz</button>
        <div id="result" class="status"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCotpjWvQ5cG5cOpgiNvpAS4ftvwKRO_N0",
            authDomain: "eduhub-a3762.firebaseapp.com",
            databaseURL: "https://eduhub-a3762-default-rtdb.firebaseio.com",
            projectId: "eduhub-a3762",
            storageBucket: "eduhub-a3762.appspot.com",
            messagingSenderId: "115221366217",
            appId: "1:115221366217:web:d6cee26ef04752d1519418",
            measurementId: "G-X1MQF5SR3Z"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function loadQuiz() {
            const examKey = localStorage.getItem('currentExam');
            database.ref(`exams/${examKey}`).once('value').then(snapshot => {
                const examData = snapshot.val();
                document.getElementById('examTitle').innerText = examData.title;

                const quizContainer = document.getElementById('quizContainer');
                quizContainer.innerHTML = '';

                const quizzesRef = database.ref(`exams/${examKey}/quizzes`);
                quizzesRef.once('value').then(quizSnapshot => {
                    quizSnapshot.forEach(childSnapshot => {
                        const quizData = childSnapshot.val();
                        const quizItem = document.createElement('div');
                        quizItem.className = 'quiz-item';
                        quizItem.innerHTML = `
                            <h3>${quizData.title}</h3>
                            <p>${quizData.question}</p>
                            ${quizData.options.map((option, index) => `
                                <label>
                                    <input type="radio" name="quiz_${childSnapshot.key}" value="${index + 1}"> ${option}
                                </label>
                            `).join('')}
                        `;
                        quizContainer.appendChild(quizItem);
                    });
                });
            });
        }

        document.getElementById('submitQuiz').onclick = function() {
            const examKey = localStorage.getItem('currentExam');
            const quizzesRef = database.ref(`exams/${examKey}/quizzes`);

            quizzesRef.once('value').then(quizSnapshot => {
                let score = 0;
                let totalQuestions = 0;

                quizSnapshot.forEach(childSnapshot => {
                    totalQuestions++;
                    const quizData = childSnapshot.val();
                    const selectedAnswer = document.querySelector(`input[name="quiz_${childSnapshot.key}"]:checked`);
                    if (selectedAnswer && selectedAnswer.value === quizData.correctOption) {
                        score++;
                    }
                });

                const resultText = `You scored ${score} out of ${totalQuestions}`;
                document.getElementById('result').innerText = resultText;
            });
        };

        // Load quiz on page load
        window.onload = loadQuiz;
    </script>
</body>
</html>
